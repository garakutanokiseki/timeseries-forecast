package com.workday.insights.timeseries.arima;

import com.spr.intuition.arima.ArimaAutoFit;
import com.spr.intuition.arima.ArimaParams;
import com.spr.intuition.arima.CanovaHansenTest;
import org.junit.Test;

import java.util.Arrays;
import java.util.TreeMap;

/**
 * Created by amandeeparora on 30/10/18.
 */
public class ArimaTest {

    private static final double[] testData = {1697 ,4904 ,4841 ,5004 ,4993 ,4594 ,4828 ,4806 ,4872 ,3767 ,4117 ,4184 ,3345 ,2902 ,3143 ,3291 ,3452 ,3735 ,3786 ,5450 ,4769 ,5314 ,5237 ,5709 ,5243 ,6991 ,8171 ,6098 ,5316 ,4900 ,6170 ,9517 ,8895 ,7490 ,6551 ,7582 ,5818 ,5219 ,5288 ,4853 ,4601 ,8186 ,12218 ,10410 ,9530 ,8099 ,7712 ,6831 ,6315 ,5196 ,4259 ,3694 ,3687 ,3643 ,4076 ,4938 ,4685 ,4246 ,4224 ,3888 ,3409 ,3656 ,3146 ,3469 ,3083 ,5939 ,4167 ,4064 ,4218 ,4354 ,4608 ,4296 ,4653 ,4387 ,3516 ,3744 ,3242 ,3438 ,3089 ,2827 ,2849
            ,3421,3286,3353,2986,2819,2733,3321,2780,2920,2958,3050,3538,4024,3774,682,466,416,1758,2011,2063,1929,2072,1860,2016,2314,2201,2245,2662,3081,2917,2824,3151,84,3229,3313,3601,3823,2739,1390,3741,3834,3695,3689,3643,3725,2918,2736,3741,3874,3840,3792,3555,3543,3072,2751,2870,2789,3444,3788,4128,4761
            ,6174,5872,6177,6215,6011,5904,5925,6390,6321,6272,6506,8936,8377,7748,6147,4933,4065,3694,3562,3803,4316,5010,5440,6284,6489,6766,6934,6638,5158,4717,4506,4320,3887,3767,3519,4084,3739,3298,2803,2648,2637,2184,2359,2892,3399,3993,3795,4084,4261,4584,4657,4588,4565,4469,4499,3936,3525,3132,1675,3262,3726,3127,2696,3334,6708,7117,6097,7821,19742,15657,8829,8322,7097,5736,4731,4592,4208,4084,4020,3802,4076,3628,3571,3830,3592,2931,2788,2954,2831,3024,2833,3219,3840,4140
            ,4732,4445,4530,4647,3596,3457,4164,4477,3965,3919,3603,3515,3360,3356,2875,2628,2991,3293,2919,3103,3323,3397,3599,5593,6291,5621,4834,4740,4158,4070,3835,4106,3514,3418,3368,3157,3111,3572,3284,2870,2785,3073,3655,2665,4620,5068,5397,6280,10035,10176,9761,7805,7735,5842,4521,4042,3829,3277,4069,3769,4233
            ,3138,3086,2519,3228,3997,4395,2566,3321,3136,2296,2786,5070,4283,3636,2869,2974,2880,2386,2311,1963,1928,2024,1954,1476,1510,1359,1774,1877,2214,2699,2184,1474,1380,2235,2246,1522,1820,1655,1288,1310,1151,2473,1110,1102,2287,2305,1034,1192,1076,1153,1565,2379,2917,1867,2368,2244,2091,1815,1510,1326,1292,1252,2449,1625,1225,1178,2141,1037,1900,939,2281,1907,946,1979,2649,1572,1332,1488,2796,2210,2229,2889,2383,1818,3351,1617,3327,1586,1464,1473,2696,3875,2769,1375,2851,2792,3144,1526,1875,2704,2170,2405};


    @Test
    public void testDiff() {
        double[] val = {1, 3, 7, 15, 31, 63};
        double[] diff = ArimaAutoFit.differencesOfOrderD(val, 2, 1);
        assert diff[5] == 16;

    }

    @Test
    public void chtest() {
        double[] train = Arrays.copyOfRange(testData, 0, 360);
        double[] test = Arrays.copyOfRange(testData, 360, testData.length);
        int d = CanovaHansenTest.estimateSeasonalDifferencingTerm(train, 24, 2);
        assert d == 0;
    }

    @Test
    public void autoFitTest() {
        double[] train = Arrays.copyOfRange(testData, 0, 360);
        ArimaParams params = ArimaAutoFit.autoFit(train, 5, 2, 5, 2, 2, 1 , 1, false, 20);
        assert params != null;
        assert params.p == 3;
        assert params.q == 0;
        assert params.d == 1;
    }

    @Test
    public void autoFitSeaonalTest() {
        double[] train = Arrays.copyOfRange(testData, 0, 360);
        double[] test = Arrays.copyOfRange(testData, 360, testData.length);
        ArimaParams params = ArimaAutoFit.autoFit(train, 5, 2, 5, 2, 2, 1 , 24, true, 50);
        assert params.p == 5;
        assert params.q == 1;
        assert params.P == 2;
        assert params.Q == 0;
        assert params.d == 1;
    }

}
